<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Content Hub</title>
  <style>
    :root {
      color-scheme: light dark;
      font-family: system-ui, sans-serif;
    }
    body {
      margin: 0;
      padding: 16px;
      background: #f5f5f5;
    }
    h1 {
      margin-top: 0;
    }
    .layout {
      display: grid;
      gap: 16px;
      grid-template-columns: 320px 1fr;
      align-items: start;
    }
    .panel {
      background: #fff;
      border-radius: 8px;
      padding: 16px;
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
    }
    .panel h2 {
      margin-top: 0;
      font-size: 1.1rem;
    }
    label {
      display: flex;
      flex-direction: column;
      font-size: 0.95rem;
      margin-bottom: 12px;
      gap: 4px;
    }
    input, textarea, select {
      padding: 8px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font: inherit;
    }
    textarea {
      min-height: 120px;
      resize: vertical;
    }
    button {
      cursor: pointer;
      padding: 8px 12px;
      border: none;
      border-radius: 6px;
      background: #333;
      color: #fff;
      font-weight: 600;
      transition: background 0.2s ease;
    }
    button:hover {
      background: #111;
    }
    .cards {
      display: grid;
      gap: 16px;
      grid-template-columns: repeat(auto-fit, minmax(340px, 1fr));
      align-items: stretch;
      grid-auto-rows: 1fr;
    }
    .card {
      background: #fff;
      border-radius: 8px;
      padding: 12px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.06);
      display: flex;
      flex-direction: column;
      gap: 12px;
      border: 1px solid #e3e3e3;
    }
    .card.dragging {
      opacity: 0.6;
    }
    .card.drop-target {
      outline: 2px dashed #999;
    }
    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 12px;
    }
    .title-group {
      display: flex;
      flex-direction: column;
      gap: 4px;
      flex: 1;
    }
    .title-group h3 {
      margin: 0;
    }
    .title-group small {
      display: block;
      margin: 0;
      color: #666;
    }
    .header-input {
      font: inherit;
      border: 1px solid #ccc;
      border-radius: 6px;
      padding: 6px 8px;
      width: 100%;
      box-sizing: border-box;
    }
    .status-wrap {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 8px;
    }
    .status {
      padding: 4px 8px;
      border-radius: 999px;
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      background: #f0f0f0;
      color: #444;
    }
    .status-select {
      font: inherit;
      border-radius: 6px;
      padding: 6px 8px;
      border: 1px solid #ccc;
      background: #fff;
      cursor: pointer;
    }
    .status[data-state="in-progress"] {
      background: #fde7aa;
      color: #8a5a00;
    }
    .status[data-state="completed"] {
      background: #c7f5c4;
      color: #1d7018;
    }
    .card-actions {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }
    .card-actions button.secondary {
      background: #e0e0e0;
      color: #222;
    }
    .card-actions button.secondary.small {
      padding: 4px 8px;
      font-size: 0.8rem;
    }
    .card-actions button.danger {
      background: #d9534f;
    }
    .card-actions button.secondary.danger,
    .editor-section-controls button.secondary.danger {
      background: #f6d6d6;
      color: #7a0000;
    }
    .card-actions button.secondary.danger:hover,
    .editor-section-controls button.secondary.danger:hover {
      background: #e9bcbc;
    }
    .card-body {
      display: flex;
      flex-direction: column;
      gap: 8px;
      cursor: pointer;
    }
    .card-summary {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    .summary-section {
      display: flex;
      align-items: baseline;
      gap: 6px;
      font-size: 0.85rem;
      color: #444;
    }
    .summary-section strong {
      font-size: 0.85rem;
      max-width: 150px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .summary-section span {
      flex: 1;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      color: #666;
    }
    .summary-more {
      font-size: 0.75rem;
      color: #999;
      text-transform: uppercase;
      letter-spacing: 0.04em;
    }
    .editor-sections {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    .editor-section {
      border: 1px solid #e0e0e0;
      border-radius: 6px;
      padding: 12px;
      background: #fff6e8;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .editor-section label {
      display: flex;
      flex-direction: column;
      gap: 6px;
      font-size: 0.9rem;
    }
    .editor-section-controls {
      display: flex;
      justify-content: flex-end;
      gap: 8px;
    }
    .add-idea {
      align-self: flex-start;
      margin-top: 4px;
    }
    dialog#card-detail {
      border: none;
      border-radius: 12px;
      padding: 0;
      width: min(640px, 90vw);
      max-height: 90vh;
      box-shadow: 0 20px 50px rgba(0, 0, 0, 0.35);
    }
    .detail-form {
      display: flex;
      flex-direction: column;
      gap: 16px;
      padding: 24px;
      background: #fff;
      max-height: 90vh;
      overflow: auto;
    }
    .detail-sections {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    .detail-header {
      display: grid;
      gap: 8px;
    }
    .detail-actions {
      display: flex;
      justify-content: space-between;
      gap: 12px;
      flex-wrap: wrap;
    }
    .detail-actions .left,
    .detail-actions .right {
      display: flex;
      gap: 8px;
    }
    .empty-state {
      color: #666;
      font-style: italic;
      margin: 0;
    }
    @media (max-width: 860px) {
      .layout {
        grid-template-columns: 1fr;
      }
      .cards {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <h1>Content Hub</h1>
  <div class="layout">
    <section class="panel">
      <h2>Create Card</h2>
      <form id="card-form">
        <label>
          Handle / Project
          <input id="field-handle" name="handle" placeholder="@lana_yaps" />
        </label>
        <label>
          Headline
          <input id="field-title" name="title" placeholder="Theme or goal for this card" required />
        </label>
        <label>
          Status
          <select id="field-status" name="status">
            <option value="draft">Draft</option>
            <option value="in-progress">In Progress</option>
            <option value="completed">Completed</option>
          </select>
        </label>
        <label>
          Idea (optional)
          <textarea id="field-notes" name="notes" placeholder="Brainstorm, outline, script..."></textarea>
        </label>
        <label>
          Additional Idea (optional)
          <textarea id="field-script" name="script" placeholder="Use this for a second hook or remix..."></textarea>
        </label>
        <button type="submit">Save Card</button>
      </form>
    </section>
    <section class="panel">
      <div class="card-actions" style="justify-content: space-between; align-items:center; margin-bottom: 12px;">
        <h2 style="margin:0;">Cards</h2>
        <select id="filter-status">
          <option value="all">All statuses</option>
          <option value="draft">Draft</option>
          <option value="in-progress">In Progress</option>
          <option value="completed">Completed</option>
        </select>
      </div>
      <div id="card-list" class="cards"></div>
    </section>
  </div>
  <template id="card-template">
    <article class="card">
      <header class="card-header">
        <div class="title-group">
          <h3 data-handle-text></h3>
          <small data-title-text></small>
        </div>
        <div class="status-wrap">
          <span class="status" data-status></span>
        </div>
      </header>
      <section class="card-body" data-card-body></section>
      <footer class="card-actions">
        <button type="button" class="secondary" data-open-card>Open</button>
        <button type="button" class="secondary" data-cycle-status>Next Status</button>
        <button type="button" class="danger" data-delete>Delete</button>
      </footer>
    </article>
  </template>
  <dialog id="card-detail"></dialog>
  <script>
    const STORAGE_KEY = "content-hub.cards";
    /** @typedef {{id:string, handle:string, title:string, status:"draft"|"in-progress"|"completed", sections:Array<{id:string,title:string,content:string}>, updatedAt:number}} Card */

    /** @returns {Card[]} */
    function loadCards() {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (!raw) return [];
      try {
        const parsed = JSON.parse(raw);
        if (!Array.isArray(parsed)) return [];
        return parsed.map(card => {
          const {
            id,
            handle,
            title,
            status,
            notes,
            script,
            sections,
            updatedAt,
          } = card || {};

          let normalizedSections = Array.isArray(sections)
            ? sections
                .map(section => ({
                  id: typeof section?.id === "string" ? section.id : crypto.randomUUID(),
                  title: typeof section?.title === "string" ? section.title : "",
                  content: typeof section?.content === "string" ? section.content : "",
                }))
                .filter(section => section)
            : [];

          if (!normalizedSections.length) {
            const fallback = [];
            if (typeof notes === "string" && notes.trim().length) {
              fallback.push({
                id: crypto.randomUUID(),
                title: "Idea 1",
                content: notes,
              });
            }
            if (typeof script === "string" && script.trim().length) {
              fallback.push({
                id: crypto.randomUUID(),
                title: "Idea 2",
                content: script,
              });
            }
            normalizedSections = fallback;
          }

          return {
            id: typeof id === "string" ? id : crypto.randomUUID(),
            handle: typeof handle === "string" ? handle : "",
            title: typeof title === "string" ? title : "",
            status: ["draft", "in-progress", "completed"].includes(status) ? status : "draft",
            sections: normalizedSections,
            updatedAt: typeof updatedAt === "number" ? updatedAt : Date.now(),
          };
        });
      } catch (_) {
        console.warn("Failed to parse stored cards, resetting.");
        localStorage.removeItem(STORAGE_KEY);
        return [];
      }
    }

    /** @param {Card[]} cards */
    function saveCards(cards) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(cards));
    }

    function displayOrNA(value) {
      return value && value.trim().length ? value : "n/a";
    }

    function cloneSections(sections) {
      return Array.isArray(sections)
        ? sections.map(section => ({
            id: typeof section?.id === "string" ? section.id : crypto.randomUUID(),
            title: typeof section?.title === "string" ? section.title : "",
            content: typeof section?.content === "string" ? section.content : "",
          }))
        : [];
    }

    function renderSectionEditors(container, sections) {
      container.innerHTML = "";
      const list = document.createElement("div");
      list.className = "editor-sections";

      const buildEditorRows = () => {
        list.innerHTML = "";
        if (!sections.length) {
          const hint = document.createElement("p");
          hint.className = "empty-state";
          hint.textContent = "No ideas yet. Add one below.";
          list.appendChild(hint);
        }

        sections.forEach(section => {
          const row = document.createElement("div");
          row.className = "editor-section";
          row.dataset.sectionId = section.id;

          const titleLabel = document.createElement("label");
          titleLabel.textContent = "Idea Title";
          const titleInput = document.createElement("input");
          titleInput.type = "text";
          titleInput.className = "header-input";
          titleInput.value = section.title;
          titleInput.placeholder = "Hook or topic";
          titleInput.addEventListener("input", (event) => {
            section.title = event.target.value;
          });
          titleLabel.appendChild(titleInput);
          row.appendChild(titleLabel);

          const contentLabel = document.createElement("label");
          contentLabel.textContent = "Idea Details";
          const contentInput = document.createElement("textarea");
          contentInput.className = "content-editor";
          contentInput.value = section.content;
          contentInput.placeholder = "Brainstorm, outline, script...";
          contentInput.addEventListener("input", (event) => {
            section.content = event.target.value;
          });
          contentLabel.appendChild(contentInput);
          row.appendChild(contentLabel);

          const controls = document.createElement("div");
          controls.className = "editor-section-controls";
          const removeBtn = document.createElement("button");
          removeBtn.type = "button";
          removeBtn.className = "secondary danger";
          removeBtn.textContent = "Remove";
          removeBtn.addEventListener("click", () => {
            const index = sections.findIndex(item => item.id === section.id);
            if (index !== -1) {
              sections.splice(index, 1);
              buildEditorRows();
            }
          });
          controls.appendChild(removeBtn);
          row.appendChild(controls);

          list.appendChild(row);
        });
      };

      buildEditorRows();
      container.appendChild(list);

      const addButton = document.createElement("button");
      addButton.type = "button";
      addButton.className = "secondary add-idea";
      addButton.textContent = "Add Idea";
      addButton.addEventListener("click", () => {
        const newSection = {
          id: crypto.randomUUID(),
          title: "",
          content: "",
        };
        sections.push(newSection);
        buildEditorRows();
        const lastTextarea = container.querySelector('.editor-section:last-of-type textarea');
        if (lastTextarea) {
          requestAnimationFrame(() => lastTextarea.focus());
        }
      });
      container.appendChild(addButton);
    }

    function renderSummary(container, sections) {
      container.innerHTML = "";
      container.classList.add("card-summary");
      if (!sections.length) {
        const placeholder = document.createElement("p");
        placeholder.className = "empty-state";
        placeholder.textContent = "No ideas yet";
        container.appendChild(placeholder);
        return;
      }

      const fragment = document.createDocumentFragment();
      sections.slice(0, 3).forEach(section => {
        const row = document.createElement("div");
        row.className = "summary-section";
        const titleEl = document.createElement("strong");
        titleEl.textContent = displayOrNA(section.title);
        row.appendChild(titleEl);
        const previewEl = document.createElement("span");
        const content = (section.content || "").replace(/\s+/g, " ").trim();
        previewEl.textContent = content.length ? content : "n/a";
        row.appendChild(previewEl);
        fragment.appendChild(row);
      });

      if (sections.length > 3) {
        const more = document.createElement("span");
        more.className = "summary-more";
        more.textContent = `+${sections.length - 3} more idea${sections.length - 3 === 1 ? "" : "s"}`;
        fragment.appendChild(more);
      }

      container.appendChild(fragment);
    }

    function openCardDialog(cardId) {
      const cards = loadCards();
      const card = cards.find(item => item.id === cardId);
      if (!card) return;

      const dialog = document.getElementById("card-detail");
      if (dialog.open) {
        dialog.close();
      }
      dialog.innerHTML = "";

      const form = document.createElement("form");
      form.className = "detail-form";
      form.method = "dialog";

      const header = document.createElement("div");
      header.className = "detail-header";

      const handleLabel = document.createElement("label");
      handleLabel.textContent = "Handle / Project";
      const handleInput = document.createElement("input");
      handleInput.type = "text";
      handleInput.className = "header-input";
      handleInput.value = card.handle;
      handleInput.placeholder = "@handle";
      handleLabel.appendChild(handleInput);
      header.appendChild(handleLabel);

      const titleLabel = document.createElement("label");
      titleLabel.textContent = "Headline";
      const titleInput = document.createElement("input");
      titleInput.type = "text";
      titleInput.className = "header-input";
      titleInput.required = true;
      titleInput.value = card.title;
      titleInput.placeholder = "Theme or goal";
      titleLabel.appendChild(titleInput);
      header.appendChild(titleLabel);

      const statusLabel = document.createElement("label");
      statusLabel.textContent = "Status";
      const statusSelect = document.createElement("select");
      statusSelect.className = "status-select";
      [
        { value: "draft", label: "Draft" },
        { value: "in-progress", label: "In Progress" },
        { value: "completed", label: "Completed" },
      ].forEach(option => {
        const opt = document.createElement("option");
        opt.value = option.value;
        opt.textContent = option.label;
        if (option.value === card.status) opt.selected = true;
        statusSelect.appendChild(opt);
      });
      statusLabel.appendChild(statusSelect);
      header.appendChild(statusLabel);

      form.appendChild(header);

      const sectionsContainer = document.createElement("div");
      sectionsContainer.className = "detail-sections";
      const workingSections = cloneSections(card.sections);
      renderSectionEditors(sectionsContainer, workingSections);
      form.appendChild(sectionsContainer);

      const actions = document.createElement("div");
      actions.className = "detail-actions";
      const leftActions = document.createElement("div");
      leftActions.className = "left";
      const cancelBtn = document.createElement("button");
      cancelBtn.type = "button";
      cancelBtn.className = "secondary";
      cancelBtn.textContent = "Cancel";
      cancelBtn.addEventListener("click", () => dialog.close());
      leftActions.appendChild(cancelBtn);

      const rightActions = document.createElement("div");
      rightActions.className = "right";
      const saveBtn = document.createElement("button");
      saveBtn.type = "submit";
      saveBtn.textContent = "Save";
      rightActions.appendChild(saveBtn);

      actions.appendChild(leftActions);
      actions.appendChild(rightActions);
      form.appendChild(actions);

      form.addEventListener("submit", (event) => {
        event.preventDefault();
        const handleValue = handleInput.value.trim();
        const titleValue = titleInput.value.trim();
        const statusValue = statusSelect.value;
        if (!titleValue) {
          alert("Please add a headline/title for the card.");
          titleInput.focus();
          return;
        }

        const cleanedSections = workingSections.map(section => ({
          id: section.id || crypto.randomUUID(),
          title: (section.title || "").trim(),
          content: (section.content || "").trim(),
        }));

        updateCard(card.id, {
          handle: handleValue,
          title: titleValue,
          status: statusValue,
          sections: cleanedSections,
        });
        dialog.close();
      });

      dialog.appendChild(form);
      if (typeof dialog.showModal === "function") {
        dialog.showModal();
      }
    }

    let dragCardId = null;

    function reorderCards(dragId, dropId = null, placement = "after") {
      const cards = loadCards();
      const dragIndex = cards.findIndex(card => card.id === dragId);
      if (dragIndex === -1) return;
      const dropIndexOriginal = dropId ? cards.findIndex(card => card.id === dropId) : -1;
      const [dragCard] = cards.splice(dragIndex, 1);

      let targetIndex;
      if (dropIndexOriginal === -1) {
        targetIndex = cards.length;
      } else {
        let dropIndex = dropIndexOriginal;
        if (dropIndexOriginal > dragIndex) {
          dropIndex -= 1;
        }
        targetIndex = placement === "before" ? dropIndex : dropIndex + 1;
      }

      if (targetIndex < 0) targetIndex = 0;
      if (targetIndex > cards.length) targetIndex = cards.length;

      cards.splice(targetIndex, 0, dragCard);
      saveCards(cards);
      dragCardId = null;
      document.querySelectorAll(".card.dragging").forEach(el => el.classList.remove("dragging"));
      document.querySelectorAll(".card.drop-target").forEach(el => el.classList.remove("drop-target"));
      renderCards(document.getElementById("filter-status").value);
    }

    function renderCards(filter = "all") {
      const cards = loadCards();
      const list = document.getElementById("card-list");
      list.innerHTML = "";
      const template = document.getElementById("card-template");

      const filteredCards = filter === "all" ? cards : cards.filter(card => card.status === filter);

      filteredCards.forEach(card => {
        const clone = template.content.cloneNode(true);
        const root = clone.querySelector(".card");
        root.dataset.cardId = card.id;

        const handleText = clone.querySelector("[data-handle-text]");
        const titleText = clone.querySelector("[data-title-text]");
        const statusEl = clone.querySelector("[data-status]");
        const cardBody = clone.querySelector("[data-card-body]");
        const openBtn = clone.querySelector("[data-open-card]");
        const cycleBtn = clone.querySelector("[data-cycle-status]");
        const deleteBtn = clone.querySelector("[data-delete]");

        const openCard = () => openCardDialog(card.id);

        root.draggable = true;
        root.addEventListener("dragstart", (event) => {
          dragCardId = card.id;
          document.querySelectorAll(".card.drop-target").forEach(el => el.classList.remove("drop-target"));
          root.classList.add("dragging");
          if (event.dataTransfer) {
            event.dataTransfer.effectAllowed = "move";
            event.dataTransfer.setData("text/plain", card.id);
          }
        });

        root.addEventListener("dragend", () => {
          dragCardId = null;
          root.classList.remove("dragging");
          document.querySelectorAll(".card.drop-target").forEach(el => el.classList.remove("drop-target"));
        });

        root.addEventListener("dragenter", (event) => {
          if (!dragCardId || dragCardId === card.id) return;
          event.preventDefault();
          document.querySelectorAll(".card.drop-target").forEach(el => el.classList.remove("drop-target"));
          root.classList.add("drop-target");
        });

        root.addEventListener("dragover", (event) => {
          if (!dragCardId || dragCardId === card.id) return;
          event.preventDefault();
          if (event.dataTransfer) {
            event.dataTransfer.dropEffect = "move";
          }
        });

        root.addEventListener("dragleave", (event) => {
          if (root.contains(event.relatedTarget)) return;
          root.classList.remove("drop-target");
        });

        root.addEventListener("drop", (event) => {
          if (!dragCardId || dragCardId === card.id) return;
          event.preventDefault();
          event.stopPropagation();
          root.classList.remove("drop-target");
          const bounds = root.getBoundingClientRect();
          const placement = (event.clientY - bounds.top) > bounds.height / 2 ? "after" : "before";
          reorderCards(dragCardId, card.id, placement);
        });

        handleText.textContent = displayOrNA(card.handle);
        titleText.textContent = displayOrNA(card.title);
        statusEl.textContent = formatStatus(card.status);
        statusEl.dataset.state = card.status;
        renderSummary(cardBody, card.sections);

        openBtn.addEventListener("click", (event) => {
          event.stopPropagation();
          openCard();
        });
        cardBody.addEventListener("click", openCard);

        cycleBtn.addEventListener("click", () => {
          const nextStatus = getNextStatus(card.status);
          updateCard(card.id, { status: nextStatus });
        });

        deleteBtn.addEventListener("click", () => {
          if (confirm("Delete this card?")) {
            removeCard(card.id);
          }
        });

        list.appendChild(clone);
      });

      if (!list.children.length) {
        const empty = document.createElement("p");
        empty.textContent = "No cards yet. Start by creating one on the left.";
        empty.style.color = "#555";
        list.appendChild(empty);
      }
    }

    function formatStatus(status) {
      switch (status) {
        case "in-progress":
          return "In Progress";
        case "completed":
          return "Completed";
        default:
          return "Draft";
      }
    }

    /** @param {Partial<Card>} updates */
    function updateCard(id, updates) {
      const cards = loadCards();
      const idx = cards.findIndex(card => card.id === id);
      if (idx === -1) return;
      const previousStatus = cards[idx].status;
      const updatesCopy = { ...updates };
      if (updatesCopy && Array.isArray(updatesCopy.sections)) {
        updatesCopy.sections = cloneSections(updatesCopy.sections);
      }
      const updatedCard = {
        ...cards[idx],
        ...updatesCopy,
        updatedAt: Date.now(),
      };
      cards.splice(idx, 1);

      if (updatesCopy && Object.prototype.hasOwnProperty.call(updatesCopy, "status")) {
        if (updatedCard.status === "completed") {
          cards.push(updatedCard);
        } else if (previousStatus === "completed" && updatedCard.status !== "completed") {
          cards.unshift(updatedCard);
        } else {
          cards.splice(Math.min(idx, cards.length), 0, updatedCard);
        }
      } else {
        cards.splice(Math.min(idx, cards.length), 0, updatedCard);
      }

      saveCards(cards);
      renderCards(document.getElementById("filter-status").value);
    }

    function removeCard(id) {
      const cards = loadCards().filter(card => card.id !== id);
      saveCards(cards);
      renderCards(document.getElementById("filter-status").value);
    }

    function getNextStatus(current) {
      if (current === "draft") return "in-progress";
      if (current === "in-progress") return "completed";
      return "draft";
    }

    function handleFormSubmit(event) {
      event.preventDefault();
      const data = new FormData(event.target);
      const handleValue = (data.get("handle") || "").trim();
      const titleValue = (data.get("title") || "").trim();
      const notesValue = (data.get("notes") || "").trim();
      const scriptValue = (data.get("script") || "").trim();

      const sections = [];
      if (notesValue.length) {
        sections.push({
          id: crypto.randomUUID(),
          title: "Idea 1",
          content: notesValue,
        });
      }
      if (scriptValue.length) {
        sections.push({
          id: crypto.randomUUID(),
          title: "Idea 2",
          content: scriptValue,
        });
      }

      const card = {
        id: crypto.randomUUID(),
        handle: handleValue,
        title: titleValue,
        status: data.get("status"),
        sections,
        updatedAt: Date.now(),
      };
      if (!card.title) {
        alert("Please add a headline/title for the card.");
        return;
      }
      const cards = loadCards();
      cards.push(card);
      saveCards(cards);
      event.target.reset();
      renderCards(document.getElementById("filter-status").value);
    }

    const cardListElement = document.getElementById("card-list");
    cardListElement.addEventListener("dragover", (event) => {
      if (!dragCardId) return;
      event.preventDefault();
      if (event.dataTransfer) {
        event.dataTransfer.dropEffect = "move";
      }
    });
    cardListElement.addEventListener("drop", (event) => {
      if (!dragCardId) return;
      event.preventDefault();
      const targetCard = event.target.closest(".card");
      if (!targetCard) {
        reorderCards(dragCardId, null, "after");
      }
      document.querySelectorAll(".card.drop-target").forEach(el => el.classList.remove("drop-target"));
    });

    document.getElementById("card-form").addEventListener("submit", handleFormSubmit);
    document.getElementById("filter-status").addEventListener("change", (event) => {
      renderCards(event.target.value);
    });

    // Seed example card on first visit if storage empty.
    if (!loadCards().length) {
      saveCards([{
        id: crypto.randomUUID(),
        handle: "@lana_yaps",
        title: "Launch weekly TikTok series",
        status: "draft",
        sections: [
          {
            id: crypto.randomUUID(),
            title: "Weekly theme hooks",
            content: "Brainstorm hook ideas\n\nResearch audience pain points",
          },
          {
            id: crypto.randomUUID(),
            title: "Script outline",
            content: "**Intro:** Hook in the first 3 seconds\n- Highlight this week's theme\n- Close with a CTA",
          },
        ],
        updatedAt: Date.now(),
      }]);
    }

    renderCards();
  </script>
</body>
</html>
